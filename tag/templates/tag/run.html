{% extends "base.html" %}

{% load static %}

{% block content %}
  <script>
    // We define the image source, and restart button, here as the URLs are going to be generated by Django template
    image_scr = "{% static request.path %}/{{ room_name }}/step.jpg";
    restart_button = '<a href="/{{ app_folder }}/run" class="btn btn-info"><i class="bi bi-bootstrap-reboot"></i> Restart</a>';
  
    ws_setting = "{{ ws_setting }}";
  </script>

  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="{% static app_folder %}/js/MobileControls.jsx"></script>
  <script src="{% static app_folder %}/js/script.js"></script>

  <style>
    @media (max-width: 768px) {
      .container {
        padding: 0;
      }
      .game-container {
        width: 100% !important;
        padding: 0 10px;
      }
    }
  </style>

  <section class="text-center">
    <div class="container">
      <br>
      <h2 class="text-start"><a href="/{{ app_folder }}/config" class="btn btn-info"><i class="bi bi-arrow-left"></i> Config</a></h2>
      <h1>{{ app_name }} - room <i>{{ room_name }}</i></h1>
      <h2 id="sub-title">Step 0</h2>
    </div>
  </section>

  <br>
  <div class="container">
    <div id="loading_div" class="d-flex align-items-center">
      <strong>Your game is loading...</strong> &nbsp;&nbsp;&nbsp;
      <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div>
    </div>

    <div class="game-container">
      <img id="image" style="visibility: hidden;" class="img-fluid rounded mx-auto d-block img-thumbnail" src="{% static request.path %}/{{ room_name }}/step.jpg">
    </div>
  </div>

  <!-- Mobile Controls Container -->
  <div id="mobile-controls-root"></div>

  <script>
    window.addEventListener('load', function() {
      function isMobileDevice() {
        return (window.innerWidth <= 768) || ('ontouchstart' in window);
      }

      function MobileControlsWrapper() {
        if (isMobileDevice()) {
          return React.createElement(MobileControls, {
            onUpPress: () => document.dispatchEvent(new KeyboardEvent('keydown', { key: 'ArrowUp' })),
            onDownPress: () => document.dispatchEvent(new KeyboardEvent('keydown', { key: 'ArrowDown' })),
            onLeftPress: () => document.dispatchEvent(new KeyboardEvent('keydown', { key: 'ArrowLeft' })),
            onRightPress: () => document.dispatchEvent(new KeyboardEvent('keydown', { key: 'ArrowRight' }))
          });
        }
        return null;
      }

      const rootElement = document.getElementById('mobile-controls-root');
      if (rootElement && window.MobileControls) {
        ReactDOM.render(React.createElement(MobileControlsWrapper), rootElement);
      }
    });
  </script>
{% endblock %}